name: dogma
description: Intelligent sync of Claude instructions with enforcement hooks for security and consistency
version: 1.18.2
author: Marcel Bich
repository: https://github.com/Marcel-Bich/marcel-bich-claude-marketplace

commands:
  sync:
    description: Sync Claude instructions from a GitHub repo with interactive review
    source: commands/sync.md
  cleanup:
    description: Find and fix AI-typical patterns in code (reactive cleanup)
    source: commands/cleanup.md
  lint:setup:
    description: Interactive setup for linting/formatting with Prettier
    source: commands/lint-setup.md
  lint:
    description: Run prettier check on project
    source: commands/lint.md

hooks:
  # ============================================
  # UserPromptSubmit - Runs at START of EVERY prompt
  # Reminds of rules that cannot be technically enforced
  # ============================================
  user_prompt_submit:
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/user-prompt-submit.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-intervention-reminder.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/checklist-tracking.sh"

  # ============================================
  # PreToolUse Hooks - Run BEFORE tool execution
  # Can BLOCK execution by exiting with code 1
  # ============================================
  pre_tool_use:
    # Bash hooks (git, file operations, dependencies)
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/git-add-protection.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/git-permissions.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/file-protection.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/dependency-verification.sh"

    # Write hooks (secrets, reminders)
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/secrets-detection.sh"
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/write-edit-reminder.sh"

    # Edit hooks (secrets, reminders)
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/secrets-detection.sh"
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/write-edit-reminder.sh"

  # ============================================
  # PostToolUse Hooks - Run AFTER tool execution
  # Cannot block, only warn/validate
  # ============================================
  post_tool_use:
    # Validate written content for AI traces
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/post-write-validate.sh"
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/post-write-validate.sh"

    # Detect prompt injection in fetched content
    - matcher: WebFetch
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-injection.sh"
    - matcher: WebSearch
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-injection.sh"

  # ============================================
  # Stop Hook - Runs when task completes
  # Final checks before completing
  # ============================================
  stop:
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/version-sync-check.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/lint-on-stop.sh"
