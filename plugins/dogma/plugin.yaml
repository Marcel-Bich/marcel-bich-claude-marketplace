name: dogma
description: Intelligent sync of Claude instructions with enforcement hooks for security and consistency
version: 1.29.5
author: Marcel Bich
repository: https://github.com/Marcel-Bich/marcel-bich-claude-marketplace

commands:
  sync:
    description: Sync Claude instructions from a GitHub repo with interactive review
    source: commands/sync.md
  cleanup:
    description: Find and fix AI-typical patterns in code (reactive cleanup)
    source: commands/cleanup.md
  lint:
    description: Run prettier and eslint check on project
    source: commands/lint.md
  lint:setup:
    description: Interactive setup for linting/formatting tools
    source: commands/lint/setup.md
  versioning:
    description: Check and fix version mismatches across all version files
    source: commands/versioning.md
  permissions:
    description: Create or update DOGMA-PERMISSIONS.md interactively
    source: commands/permissions.md
  force:
    description: Interactively collect and apply CLAUDE rules to the project
    source: commands/force.md
  sanitize-git:
    description: Sanitize git history from Claude/AI traces and fix tracking issues
    source: commands/sanitize-git.md
  docs-update:
    description: Sync documentation across README files and wiki articles
    source: commands/docs-update.md
  ignore:
    description: Add ignore patterns to multiple locations at once
    source: commands/ignore.md
  ignore:audit:
    description: Show which patterns are missing where
    source: commands/ignore/audit.md
  ignore:sync-all:
    description: Sync patterns from sync.md to all repos
    source: commands/ignore/sync-all.md
  recommended:setup:
    description: Check and install recommended plugins and MCP servers from a source
    source: commands/recommended/setup.md

hooks:
  # ============================================
  # UserPromptSubmit - Runs at START of EVERY prompt
  # Reminds of rules that cannot be technically enforced
  # ============================================
  user_prompt_submit:
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/user-prompt-submit.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-intervention-reminder.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/checklist-tracking.sh"

  # ============================================
  # PreToolUse Hooks - Run BEFORE tool execution
  # Can BLOCK execution by exiting with code 1
  # ============================================
  pre_tool_use:
    # Bash hooks (git, file operations, dependencies)
    # NOTE: Actual hook config is in hooks/hooks.json - this is for reference only
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/git-add-protection.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/git-permissions.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/file-protection.sh"
    - matcher: Bash
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/dependency-verification.sh"

    # Write hooks (secrets, reminders)
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/secrets-detection.sh"
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/write-edit-reminder.sh"

    # Edit hooks (secrets, reminders)
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/secrets-detection.sh"
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/write-edit-reminder.sh"

    # Read hooks (token protection) - using wildcard because Read matcher may not be supported
    - matcher: "*"
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/token-protection.sh"

  # ============================================
  # PostToolUse Hooks - Run AFTER tool execution
  # Cannot block, only warn/validate
  # ============================================
  post_tool_use:
    # Validate written content for AI traces
    - matcher: Write
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/post-write-validate.sh"
    - matcher: Edit
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/post-write-validate.sh"

    # Detect prompt injection in fetched content
    - matcher: WebFetch
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-injection.sh"
    - matcher: WebSearch
      command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/prompt-injection.sh"

  # ============================================
  # Stop Hook - Runs when task completes
  # Final checks before completing
  # ============================================
  stop:
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/version-sync-check.sh"
    - command: bash
      args:
        - -c
        - "cat | {{pluginPath}}/scripts/lint-on-stop.sh"
